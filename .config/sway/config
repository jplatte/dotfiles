# Variables
set $mod Mod4
set $menu rofi -m $(xrandr --listmonitors | tail +$(( $(swaymsg -t get_outputs | jq 'map(.focused) | index(true)') + 2 )) | head -1 | cut -d' ' -f6) -no-cycle -matching fuzzy -theme Arc-Dark -show-icons -drun-icon-theme Arc -modi drun -show drun -run-command 'swaymsg exec -- {cmd}'
set $term alacritty
set $browser firefox-nightly -P nightly
set $file_manager nautilus

# Named workspaces
set $ws1 "1:"
set $ws2 "2:"
set $ws3 "3:"
set $ws4 number 4
set $ws5 number 5
set $ws6 number 6
set $ws7 number 7
set $ws8 number 8
set $ws9 number 9
set $ws10 number 10
set $ws11 "11:"
set $ws12 "12:"
set $ws13 "13:"
set $ws14 number 15
set $ws15 number 15
set $ws16 number 16
set $ws17 number 17
set $ws18 number 18
set $ws19 number 19
set $ws20 "20:"
set $ws21 "21:"
set $ws42 "42:"

# Include host-specific config after setting variables but before everything
# else so that host-specific configs can override them
include ~/.config/sway/`hostname`/*

# Colors               (border  bg      text    indicator child_border)
client.focused          #bdbdbd #bdbdbd #000000 #bdbdbd   #bdbdbd
client.focused_inactive #333333 #5f676a #ffffff #5f676a   #5f676a
client.unfocused        #1e1e1e #1e1e1e #bdbdbd #1e1e1e   #1e1e1e
client.urgent           #2f343a #900000 #ffffff #900000   #900000

# Font
font pango:Encode Sans 11

# Window borders
default_border pixel 1
default_floating_border pixel 1
hide_edge_borders --i3 smart

workspace_layout default
#popup_during_fullscreen leave_fullscreen # TODO

# Autostart
exec redshift -m wayland
exec env GTK_THEME=HighContrast waybar -c ~/.config/waybar/`hostname`/config.json
exec sh -c "nmcli monitor | while read _; do pkill -RTMIN+1 waybar; done >/dev/null"
exec mako
# => Round volume to a multiple of 5
exec pamixer --set-volume $(pamixer --get-volume | awk '{ print int(($1 / 5) + 0.5) * 5 }')
exec $browser

# Input device configuration
input * {
    xkb_layout de
    xkb_variant nodeadkeys
    xkb_options compose:caps
    xkb_numlock enabled
}

# Output configuration
output * bg ~/Bilder/Wallpaper/FLATzero_2880x1800.jpg fill

# Default workspaces for common programs
assign [class="^Signal$"] $ws2
assign [class="^Riot$"] $ws2
assign [app_id="^thunderbird$"] $ws3
assign [app_id="^NewsFlashGTK$"] $ws3
assign [class="^Steam$"] $ws11
assign [class="^Wine$"] $ws12
assign [app_id="^org.keepassxc.KeePassXC$" title="KeePassXC$"] $ws21
assign [app_id="^io.github.quodlibet.QuodLibet$"] $ws42

# Layout defaults
for_window [app_id="^firefox$"] layout tabbed
for_window [app_id="^thunderbird$"] layout tabbed
for_window [app_id="^NewsFlashGTK$"] layout tabbed
for_window [class="^Code" title="Visual Studio Code"] layout tabbed
for_window [app_id="^zenity$"] floating enable
for_window [app_id="^glade-previewer$"] floating enable
for_window [app_id="^gnome-calculator$"] floating enable
for_window [app_id="^glade-previewer$"] floating enable
# Nautilus typeahead popup
for_window [app_id="^nautilus$" title="^nautilus$"] floating enable
for_window [app_id="^org.keepassxc.KeePassXC$" title="^KeePassXC-Browser: Zugriff bestätigen$"] floating enable
# gtk-rs programs have this id by default
for_window [app_id="^\.$"] floating enable
for_window [class="^Steam$"] layout tabbed

# Other window-specific settings
for_window [class="^Signal$"] opacity 0.9
for_window [class="^Riot$"] opacity 0.9
for_window [app_id="^org.gnome.Nautilus$"] opacity 0.9
for_window [app_id="^org.gnome.gedit$"] opacity 0.9
for_window [app_id="^file-roller$"] opacity 0.9
for_window [app_id="^org.keepassxc.KeePassXC$" title="KeePassXC$"] opacity 0.9
for_window [app_id="^io.github.quodlibet.QuodLibet$"] opacity 0.9
for_window [app_id="^zenity$"] opacity 0.9

# Program shortcuts
bindsym $mod+Return exec $term
bindsym $mod+n exec $file_manager
bindsym $mod+g exec gedit
bindsym $mod+c exec ~/.local/bin/scripts/open_project ~/Projekte
bindsym $mod+Mod1+c exec ~/.local/bin/scripts/open_code_workspace ~/Projekte
bindsym $mod+y workspace $ws1; exec $browser
bindsym $mod+Shift+Y exec firefox-nightly -P yt

# Screenshots
# => Capture of all screens
bindsym Print         exec grim $(xdg-user-dir PICTURES)/$(date +'Screenshot_%Y-%m-%d_%H%M%S.png')
# => Select a window to capture
bindsym Mod1+Print    exec swaymsg -t get_tree | jq -r '.. | ((.nodes?, .floating_nodes?) // empty)[] | select(.pid and .visible) | .rect | "\(.x),\(.y) \(.width)x\(.height)"' | slurp | grim -g - $(xdg-user-dir PICTURES)/$(date +'Screenshot_%Y-%m-%d_%H%M%S.png')
# Select a screen to capture
bindsym Shift+Print   exec swaymsg -t get_outputs | jq -r '.[] | select(.active) | .rect | "\(.x),\(.y) \(.width)x\(.height)"' | slurp | grim -g - $(xdg-user-dir PICTURES)/$(date +'Screenshot_%Y-%m-%d_%H%M%S.png')
# => Select a region to capture
bindsym Control+Print exec slurp | grim -g - $(xdg-user-dir PICTURES)/$(date +'Screenshot_%Y-%m-%d_%H%M%S.png')

# Notifications
bindsym Control+Space exec makoctl dismiss
bindsym Control+Shift+Space exec makoctl dismiss --all

# Lock screen
bindsym Control+Mod1+l exec ~/.local/bin/scripts/lock

# ... automatically when systemd requests it
exec swayidle lock ~/.local/bin/scripts/lock

# Poweroff, reboot prompts
bindsym Control+$mod+q exec ~/.local/bin/scripts/zenity-poweroff
bindsym Control+$mod+x exec ~/.local/bin/scripts/zenity-poweroff
bindsym Control+$mod+r exec ~/.local/bin/scripts/zenity-reboot
bindsym Control+$mod+s exec ~/.local/bin/scripts/zenity-suspend

# Volume controls
bindsym XF86AudioRaiseVolume exec pamixer -i 5
bindsym XF86AudioLowerVolume exec pamixer -d 5
bindsym XF86AudioMute        exec pamixer -t

# Music player controls
bindsym XF86AudioPrev exec playerctl stop && playerctl previous && playerctl play
bindsym XF86AudioPlay exec playerctl play-pause || quodlibet --run --play
bindsym XF86AudioNext exec playerctl next && playerctl play

# Move workspace between outputs
bindsym $mod+x move workspace to output right

bindsym Control+$mod+h move workspace to output left
bindsym Control+$mod+j move workspace to output down
bindsym Control+$mod+k move workspace to output right
bindsym Control+$mod+l move workspace to output up

# Kill focused window
bindsym $mod+Shift+q kill

# Start your launcher
bindsym $mod+d exec $menu

# Drag floating windows by holding down $mod and left mouse button.
# Resize them with right mouse button + $mod.
# Despite the name, also works for non-floating windows.
# Change normal to inverse to use left mouse button for resizing and right
# mouse button for dragging.
floating_modifier $mod normal

# Reload the configuration file
bindsym $mod+Shift+c reload

# Exit sway (logs you out of your wayland session)
bindsym $mod+Shift+e exit

# Move your focus around with $mod+[h|j|k|l], like vim
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right
# or use $mod+[up|down|left|right]
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# _move_ the focused window with the same, but add Shift
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right
# ditto, with arrow keys
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10
bindsym $mod+F1 workspace $ws11
bindsym $mod+F2 workspace $ws12
bindsym $mod+F3 workspace $ws13
bindsym $mod+F4 workspace $ws14
bindsym $mod+F5 workspace $ws15
bindsym $mod+F6 workspace $ws16
bindsym $mod+F7 workspace $ws17
bindsym $mod+F8 workspace $ws18
bindsym $mod+F9 workspace $ws19
bindsym $mod+F10 workspace $ws20
bindsym $mod+F11 workspace $ws21
bindsym $mod+F12 workspace $ws42

# Switch to previous / next workspace using horizontal mouse wheel
# the + before button6 / button7 seems to be mandatory
bindsym --whole-window --border --input-device=1133:16449:Logitech_MX_Master +button6 exec ~/.cargo/bin/i3-workspace-scroll prev
bindsym --whole-window --border --input-device=1133:16449:Logitech_MX_Master +button7 exec ~/.cargo/bin/i3-workspace-scroll next
bindsym --whole-window --border --input-device=1133:16480:Logitech_MX_Master +button6 exec ~/.cargo/bin/i3-workspace-scroll prev
bindsym --whole-window --border --input-device=1133:16480:Logitech_MX_Master +button7 exec ~/.cargo/bin/i3-workspace-scroll next
bindsym --whole-window --border --input-device=1133:16480:Logitech_Wireless_Mouse_PID:4060 +button6 exec ~/.cargo/bin/i3-workspace-scroll prev
bindsym --whole-window --border --input-device=1133:16480:Logitech_Wireless_Mouse_PID:4060 +button7 exec ~/.cargo/bin/i3-workspace-scroll next

bindsym --input-device=1133:16449:Logitech_MX_Master    Control+Mod1+Tab move workspace to output right
bindsym --input-device=1133:16480:Logitech_MX_Master    Control+Mod1+Tab move workspace to output right
bindsym --input-device=1133:16489:Logitech_MX_Master_2S Control+Mod1+Tab move workspace to output right

# Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10
bindsym $mod+Shift+F1 move container to workspace $ws11
bindsym $mod+Shift+F2 move container to workspace $ws12
bindsym $mod+Shift+F3 move container to workspace $ws13
bindsym $mod+Shift+F4 move container to workspace $ws14
bindsym $mod+Shift+F5 move container to workspace $ws15
bindsym $mod+Shift+F6 move container to workspace $ws16
bindsym $mod+Shift+F7 move container to workspace $ws17
bindsym $mod+Shift+F8 move container to workspace $ws18
bindsym $mod+Shift+F9 move container to workspace $ws19
bindsym $mod+Shift+F10 move container to workspace $ws20
bindsym $mod+Shift+F11 move container to workspace $ws21
bindsym $mod+Shift+F12 move container to workspace $ws42

# Layout stuff
bindsym $mod+b splith
bindsym $mod+v splitv

# Switch the current container between different layout styles
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# Make the current focus fullscreen
bindsym $mod+f fullscreen

# Toggle the current focus between tiling and floating mode
bindsym $mod+Shift+space floating toggle

# Swap focus between the tiling area and the floating area
bindsym $mod+space focus mode_toggle

# move focus to the parent container
bindsym $mod+a focus parent

# Move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $mod+minus scratchpad show
